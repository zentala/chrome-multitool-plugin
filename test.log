
> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rates_USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rate_USD_PLN

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Parsing text: ÔéČ50.99

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Raw response: {"success":true,"amount":50.99,"currencyCode":"EUR"}
GoogleAIAdapter: Parsed JSON: { success: [33mtrue[39m, amount: [33m50.99[39m, currencyCode: [32m'EUR'[39m }

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return rate from fresh PAIR cache without calling API
[22m[39mExchangeRateService: Cache hit for key: rate_EUR_GBP

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if generateContent throws an error
[22m[39mGoogleAIAdapter: Parsing text: bad input

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache expired for key: rate_GBP_JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache miss or invalid for GBP -> JPY, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Fetching rates from API for base: GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rates_GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rate_GBP_JPY

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Parsing text: 100 pesos

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Raw response: {"success":false,"error":"parsing_failed","reason":"currency ambiguous","needsClarification":true}
GoogleAIAdapter: Parsed JSON: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed'[39m,
  reason: [32m'currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}
AI indicated failure/clarification: parsing_failed

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Parsing text: any input

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Raw response: this is not json

 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 39[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache expired for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache miss or invalid for CAD -> CHF, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Fetching rates from API for base: CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rates_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache expired for key: rate_CHF_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache miss or invalid for CHF -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: CHF

[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Cache miss or invalid for AUD -> NZD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: AUD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Cache miss or invalid for USD -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Cache miss or invalid for JPY -> KRW, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Fetching rates from API for base: JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Stored data in cache for key: rates_JPY

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Cache miss or invalid for HKD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Fetching rates from API for base: HKD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Cache miss or invalid for NZD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Fetching rates from API for base: NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rates_NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rate_NZD_SGD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Cache miss or invalid for SGD -> HKD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Fetching rates from API for base: SGD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Cache miss or invalid for EUR -> USD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Fetching rates from API for base: EUR

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 147[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 173[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [31mÔŁ»[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1325[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mrenders initial state correctly[32m 119[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mupdates input value on change[32m 11[2mms[22m[39m
[31m   [31m├Ś[31m CurrencyConverter Component[2m > [22mcalls sendMessage and displays result on successful conversion[39m[32m 26[2mms[22m[39m
[31m     Ôćĺ [2mexpect([22m[31melement[31m[2m).toBeDisabled()[22m

Received element is not disabled:
  [31m<button
  class="_button_3c782d"
/>[31m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mdisplays error message on failed conversion[32m 34[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mshows clarification input when needsClarification is true[32m 44[2mms[22m[39m
[31m   [31m├Ś[31m CurrencyConverter Component[2m > [22msends clarification message and displays result after retry[39m[33m 1032[2mms[22m[39m
[31m     Ôćĺ Unable to find an element with the text: /Please specify pesos type (MXN, COP, etc.)/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_clarificationArea_3c782d"[31m
      [36m>[31m
        [36m<label[31m
          [33mclass[31m=[32m"_clarificationLabel_3c782d"[31m
          [33mfor[31m=[32m"clarificationInput"[31m
        [36m>[31m
          [0mPlease specify pesos type (MXN, COP, etc.)[0m
        [36m</label>[31m
        [36m<div[31m
          [33mclass[31m=[32m"_inputRow_3c782d"[31m
        [36m>[31m
          [0m [0m
          [36m<input[31m
            [33mclass[31m=[32m"_inputField_3c782d"[31m
            [33mid[31m=[32m"clarificationInput"[31m
            [33mmaxlength[31m=[32m"3"[31m
            [33mplaceholder[31m=[32m"e.g., USD"[31m
            [33mtype[31m=[32m"text"[31m
            [33mvalue[31m=[32m""[31m
          [36m/>[31m
          [36m<button[31m
            [33mclass[31m=[32m"_button_3c782d"[31m
            [33mdisabled[31m=[32m""[31m
          [36m>[31m
            [0mRetry[0m
          [36m</button>[31m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_clarificationArea_3c782d"[31m
      [36m>[31m
        [36m<label[31m
          [33mclass[31m=[32m"_clarificationLabel_3c782d"[31m
          [33mfor[31m=[32m"clarificationInput"[31m
        [36m>[31m
          [0mPlease specify pesos type (MXN, COP, etc.)[0m
        [36m</label>[31m
        [36m<div[31m
          [33mclass[31m=[32m"_inputRow_3c782d"[31m
        [36m>[31m
          [0m [0m
          [36m<input[31m
            [33mclass[31m=[32m"_inputField_3c782d"[31m
            [33mid[31m=[32m"clarificationInput"[31m
            [33mmaxlength[31m=[32m"3"[31m
            [33mplaceholder[31m=[32m"e.g., USD"[31m
            [33mtype[31m=[32m"text"[31m
            [33mvalue[31m=[32m""[31m
          [36m/>[31m
          [36m<button[31m
            [33mclass[31m=[32m"_button_3c782d"[31m
            [33mdisabled[31m=[32m""[31m
          [36m>[31m
            [0mRetry[0m
          [36m</button>[31m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers conversion on Enter key press in main input[32m 26[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers retry on Enter key press in clarification input[32m 32[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m48 passed[39m[22m[90m (50)[39m
[2m   Start at [22m 07:06:41
[2m   Duration [22m 3.76s[2m (transform 699ms, setup 1.21s, collect 1.21s, tests 1.70s, environment 5.22s, prepare 1.19s)[22m

ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.

> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rates_USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rate_USD_PLN

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return rate from fresh PAIR cache without calling API
[22m[39mExchangeRateService: Cache hit for key: rate_EUR_GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache expired for key: rate_GBP_JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache miss or invalid for GBP -> JPY, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Fetching rates from API for base: GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rates_GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rate_GBP_JPY

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Parsing text: ÔéČ50.99

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Raw response: {"success":true,"amount":50.99,"currencyCode":"EUR"}
GoogleAIAdapter: Parsed JSON: { success: [33mtrue[39m, amount: [33m50.99[39m, currencyCode: [32m'EUR'[39m }

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache expired for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache miss or invalid for CAD -> CHF, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Fetching rates from API for base: CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rates_CAD

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if generateContent throws an error
[22m[39mGoogleAIAdapter: Parsing text: bad input

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rate_CAD_CHF

[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Parsing text: 100 pesos

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Raw response: {"success":false,"error":"parsing_failed","reason":"currency ambiguous","needsClarification":true}
GoogleAIAdapter: Parsed JSON: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed'[39m,
  reason: [32m'currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}
AI indicated failure/clarification: parsing_failed

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Parsing text: any input

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Raw response: this is not json

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache expired for key: rate_CHF_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache miss or invalid for CHF -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: CHF

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Cache miss or invalid for AUD -> NZD, fetching from API.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: AUD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Cache miss or invalid for USD -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Cache miss or invalid for JPY -> KRW, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Fetching rates from API for base: JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Stored data in cache for key: rates_JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Cache miss or invalid for HKD -> SGD, fetching from API.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Fetching rates from API for base: HKD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Cache miss or invalid for NZD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Fetching rates from API for base: NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rates_NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rate_NZD_SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Cache miss or invalid for SGD -> HKD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Fetching rates from API for base: SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Cache miss or invalid for EUR -> USD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Fetching rates from API for base: EUR

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 142[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 168[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [31mÔŁ»[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1357[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mrenders initial state correctly[32m 116[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mupdates input value on change[32m 11[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mcalls sendMessage and displays result on successful conversion[32m 53[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mdisplays error message on failed conversion[32m 39[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mshows clarification input when needsClarification is true[32m 25[2mms[22m[39m
[31m   [31m├Ś[31m CurrencyConverter Component[2m > [22msends clarification message and displays result after retry[39m[33m 1059[2mms[22m[39m
[31m     Ôćĺ Unable to find an element by: [data-testid="spinner"]

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_resultArea_3c782d _resultError_3c782d"[31m
      [36m>[31m
        [36m<p[31m
          [33mclass[31m=[32m"_resultText_3c782d"[31m
        [36m>[31m
          [0mError: [0m
          [0mAI parsing failed[0m
        [36m</p>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_resultArea_3c782d _resultError_3c782d"[31m
      [36m>[31m
        [36m<p[31m
          [33mclass[31m=[32m"_resultText_3c782d"[31m
        [36m>[31m
          [0mError: [0m
          [0mAI parsing failed[0m
        [36m</p>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers conversion on Enter key press in main input[32m 21[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers retry on Enter key press in clarification input[32m 32[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m49 passed[39m[22m[90m (50)[39m
[2m   Start at [22m 07:14:47
[2m   Duration [22m 3.67s[2m (transform 815ms, setup 1.38s, collect 1.41s, tests 1.71s, environment 4.32s, prepare 1.02s)[22m

ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.

> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rates_USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rate_USD_PLN

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Parsing text: ÔéČ50.99

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return rate from fresh PAIR cache without calling API
[22m[39mExchangeRateService: Cache hit for key: rate_EUR_GBP

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Raw response: {"success":true,"amount":50.99,"currencyCode":"EUR"}
GoogleAIAdapter: Parsed JSON: { success: [33mtrue[39m, amount: [33m50.99[39m, currencyCode: [32m'EUR'[39m }

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if generateContent throws an error
[22m[39mGoogleAIAdapter: Parsing text: bad input

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Parsing text: 100 pesos

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Raw response: {"success":false,"error":"parsing_failed","reason":"currency ambiguous","needsClarification":true}
GoogleAIAdapter: Parsed JSON: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed'[39m,
  reason: [32m'currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}
AI indicated failure/clarification: parsing_failed

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Parsing text: any input

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Raw response: this is not json

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache expired for key: rate_GBP_JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache miss or invalid for GBP -> JPY, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Fetching rates from API for base: GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rates_GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rate_GBP_JPY

 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache expired for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache miss or invalid for CAD -> CHF, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Fetching rates from API for base: CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rates_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache expired for key: rate_CHF_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache miss or invalid for CHF -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: CHF

[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Cache miss or invalid for AUD -> NZD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: AUD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Cache miss or invalid for USD -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Cache miss or invalid for JPY -> KRW, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Fetching rates from API for base: JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Stored data in cache for key: rates_JPY

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Cache miss or invalid for HKD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Fetching rates from API for base: HKD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Cache miss or invalid for NZD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Fetching rates from API for base: NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rates_NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rate_NZD_SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Cache miss or invalid for SGD -> HKD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Fetching rates from API for base: SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Cache miss or invalid for EUR -> USD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Fetching rates from API for base: EUR

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 128[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 150[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [31mÔŁ»[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1349[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mrenders initial state correctly[32m 113[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mupdates input value on change[32m 11[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mcalls sendMessage and displays result on successful conversion[32m 47[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mdisplays error message on failed conversion[32m 29[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mshows clarification input when needsClarification is true[32m 29[2mms[22m[39m
[31m   [31m├Ś[31m CurrencyConverter Component[2m > [22msends clarification message and displays result after retry[39m[33m 1065[2mms[22m[39m
[31m     Ôćĺ Unable to find an element by: [data-testid="spinner"]

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_resultArea_3c782d _resultError_3c782d"[31m
      [36m>[31m
        [36m<p[31m
          [33mclass[31m=[32m"_resultText_3c782d"[31m
        [36m>[31m
          [0mError: [0m
          [0mAI parsing failed[0m
        [36m</p>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m

Ignored nodes: comments, script, style
[36m<body>[31m
  [36m<div>[31m
    [36m<div[31m
      [33mclass[31m=[32m"_container_3c782d"[31m
    [36m>[31m
      [36m<h4[31m
        [33mclass[31m=[32m"_title_3c782d"[31m
      [36m>[31m
        [0mCurrency Converter[0m
      [36m</h4>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_inputRow_3c782d"[31m
      [36m>[31m
        [36m<input[31m
          [33mclass[31m=[32m"_inputField_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
          [33mplaceholder[31m=[32m"e.g., 100 USD, ÔéČ50.99, 3.5M IDR"[31m
          [33mtype[31m=[32m"text"[31m
          [33mvalue[31m=[32m"100 pesos"[31m
        [36m/>[31m
        [36m<button[31m
          [33mclass[31m=[32m"_button_3c782d"[31m
          [33mdisabled[31m=[32m""[31m
        [36m>[31m
          [0mConvert to PLN[0m
        [36m</button>[31m
      [36m</div>[31m
      [36m<div[31m
        [33mclass[31m=[32m"_resultArea_3c782d _resultError_3c782d"[31m
      [36m>[31m
        [36m<p[31m
          [33mclass[31m=[32m"_resultText_3c782d"[31m
        [36m>[31m
          [0mError: [0m
          [0mAI parsing failed[0m
        [36m</p>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</div>[31m
[36m</body>[31m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers conversion on Enter key press in main input[32m 22[2mms[22m[39m
   [32mÔťô[39m CurrencyConverter Component[2m > [22mtriggers retry on Enter key press in clarification input[32m 32[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m49 passed[39m[22m[90m (50)[39m
[2m   Start at [22m 07:15:10
[2m   Duration [22m 3.60s[2m (transform 567ms, setup 1.16s, collect 1.15s, tests 1.67s, environment 4.71s, prepare 1.14s)[22m

ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.

> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rates_USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when cache is empty
[22m[39mExchangeRateService: Stored data in cache for key: rate_USD_PLN

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Parsing text: ÔéČ50.99

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should call generateContent and return success on valid JSON response
[22m[39mGoogleAIAdapter: Raw response: {"success":true,"amount":50.99,"currencyCode":"EUR"}
GoogleAIAdapter: Parsed JSON: { success: [33mtrue[39m, amount: [33m50.99[39m, currencyCode: [32m'EUR'[39m }

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return rate from fresh PAIR cache without calling API
[22m[39mExchangeRateService: Cache hit for key: rate_EUR_GBP

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if generateContent throws an error
[22m[39mGoogleAIAdapter: Parsing text: bad input

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache expired for key: rate_GBP_JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Cache miss or invalid for GBP -> JPY, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Fetching rates from API for base: GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rates_GBP

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if PAIR cache is stale
[22m[39mExchangeRateService: Stored data in cache for key: rate_GBP_JPY

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Parsing text: 100 pesos

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return parsing failed if LLM returns error JSON
[22m[39mGoogleAIAdapter: Raw response: {"success":false,"error":"parsing_failed","reason":"currency ambiguous","needsClarification":true}
GoogleAIAdapter: Parsed JSON: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed'[39m,
  reason: [32m'currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}
AI indicated failure/clarification: parsing_failed

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Parsing text: any input

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts[2m > [22m[2mGoogleAIAdapter[2m > [22m[2mparseCurrency should return error if LLM returns invalid JSON text
[22m[39mGoogleAIAdapter: Raw response: this is not json

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache expired for key: rate_CAD_CHF

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Cache miss or invalid for CAD -> CHF, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Fetching rates from API for base: CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rates_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API and update cache when PAIR cache is stale (regardless of base cache state)
[22m[39mExchangeRateService: Stored data in cache for key: rate_CAD_CHF

 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache expired for key: rate_CHF_CAD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Cache miss or invalid for CHF -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails, even if stale cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: CHF

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Cache miss or invalid for AUD -> NZD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error when API fetch fails and no cache exists
[22m[39mExchangeRateService: Fetching rates from API for base: AUD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Cache miss or invalid for USD -> CAD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API key is missing and fetch is attempted
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Cache miss or invalid for JPY -> KRW, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Fetching rates from API for base: JPY

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but data lacks target currency
[22m[39mExchangeRateService: Stored data in cache for key: rates_JPY

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Cache miss or invalid for HKD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould throw error if API returns success but conversion_rates structure is invalid
[22m[39mExchangeRateService: Fetching rates from API for base: HKD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Cache miss or invalid for NZD -> SGD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Fetching rates from API for base: NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rates_NZD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould fetch from API if storageService.get fails
[22m[39mExchangeRateService: Stored data in cache for key: rate_NZD_SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Cache miss or invalid for SGD -> HKD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mshould return API rate even if storageService.set fails
[22m[39mExchangeRateService: Fetching rates from API for base: SGD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw original Error on fetch network error
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw correct error message on non-OK response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Cache miss or invalid for USD -> PLN, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error on invalid JSON response
[22m[39mExchangeRateService: Fetching rates from API for base: USD

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Cache miss or invalid for EUR -> USD, fetching from API.

[90mstdout[2m | src/services/exchangeRateService.test.ts[2m > [22m[2mExchangeRateService[2m > [22m[2mgetRate should throw specific error if API result is "error"
[22m[39mExchangeRateService: Fetching rates from API for base: EUR

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[32m 131[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 159[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [32mÔťô[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 411[2mms[22m[39m

[2m Test Files [22m [1m[32m5 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[32m50 passed[39m[22m[90m (50)[39m
[2m   Start at [22m 07:15:58
[2m   Duration [22m 2.91s[2m (transform 812ms, setup 1.29s, collect 1.35s, tests 743ms, environment 5.14s, prepare 1.20s)[22m


> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 11[2mms[22m[39m
 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 8[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 166[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [32mÔťô[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 379[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[32m33 passed[39m[22m[90m (33)[39m
[2m   Start at [22m 07:17:44
[2m   Duration [22m 2.89s[2m (transform 561ms, setup 1.12s, collect 1.04s, tests 565ms, environment 5.30s, prepare 1.62s)[22m

ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.

> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 200[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [32mÔťô[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 492[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[32m33 passed[39m[22m[90m (33)[39m
[2m   Start at [22m 07:18:13
[2m   Duration [22m 3.42s[2m (transform 771ms, setup 1.98s, collect 1.54s, tests 728ms, environment 5.64s, prepare 1.16s)[22m

ÔÇëELIFECYCLEÔÇë Test failed. See above for more details.

> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 173[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [32mÔťô[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 760[2mms[22m[39m

[2m Test Files [22m [1m[32m5 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[32m42 passed[39m[22m[90m (42)[39m
[2m   Start at [22m 07:20:26
[2m   Duration [22m 4.75s[2m (transform 1.15s, setup 2.50s, collect 2.35s, tests 1000ms, environment 7.24s, prepare 1.84s)[22m


> chrome-multitool-plugin@1.0.0 test C:\Users\Lenovo\code\chrome-multitool-plugin
> vitest run


[1m[46m RUN [49m[22m [36mv3.1.2 [39m[90mC:/Users/Lenovo/code/chrome-multitool-plugin[39m

[90mstdout[2m | src/services/exchangeRateService.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/background/index.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/services/ai/GoogleAIAdapter.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

[90mstdout[2m | src/utils/storage.test.ts
[22m[39mSetup file loaded with manual Chrome vi mocks using vi.stubGlobal.

 [32mÔťô[39m src/services/exchangeRateService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 13[2mms[22m[39m
 [32mÔťô[39m src/utils/storage.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [32mÔťô[39m src/services/ai/GoogleAIAdapter.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | src/background/index.test.ts
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts
[22m[39mBackground script loaded.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Handling conversion request for: 100 EUR

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: AI parsed: 100 EUR. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle successful parsing and rate fetching
[22m[39mBackground: Conversion successful: 100 EUR = 450.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: Handling conversion request for: 100 pesos

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI parsing failure requiring clarification
[22m[39mBackground: AI parsing failed or needs clarification: {
  success: [33mfalse[39m,
  error: [32m'parsing_failed: currency ambiguous'[39m,
  needsClarification: [33mtrue[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: Handling conversion request for: 200 CAD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle rate fetching failure
[22m[39mBackground: AI parsed: 200 CAD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle AI service failure (AIAdapterError)
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: Handling conversion request for: 100 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mhandleCurrencyConversionRequest[2m > [22m[2mshould handle unexpected generic error during processing
[22m[39mBackground: AI parsed: 100 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.runtime.onInstalled Listener[2m > [22m[2mshould setup context menu via initializeContextMenu on install
[22m[39mContext menu initialized.

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu: Clicked! Selected text: "50 USD"
Background: Handling conversion request for: 50 USD

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: AI parsed: 50 USD. Converting to PLN...

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mBackground: Conversion successful: 50 USD = 200.00 PLN

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show success notification on valid click
[22m[39mContext menu conversion result: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'USD'[39m,
  convertedAmount: [33m200[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu: Clicked! Selected text: "invalid text"
Background: Handling conversion request for: invalid text

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mBackground: AI parsing failed or needs clarification: { success: [33mfalse[39m, error: [32m'Could not parse'[39m }

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould call handleCurrencyConversionRequest and show error notification on failed conversion
[22m[39mContext menu conversion result: {
  success: [33mfalse[39m,
  error: [32m'AI Error: Could not parse'[39m,
  needsClarification: [90mundefined[39m
}

[90mstdout[2m | src/background/index.test.ts[2m > [22m[2mBackground Script Integration Tests[2m > [22m[2mchrome.contextMenus.onClicked Listener[2m > [22m[2mshould show specific notification if no text selected
[22m[39mContext menu: Clicked, but no text selected?

 [32mÔťô[39m src/background/index.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 164[2mms[22m[39m
[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'150 EUR'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mcalls sendMessage and displays result on successful conversion
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m150[39m,
  originalCurrency: [32m'EUR'[39m,
  convertedAmount: [33m650.25[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m4.335[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'only 200'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mdisplays error message on failed conversion
[22m[39mReceived response from background: { success: [33mfalse[39m, error: [32m'AI parsing failed: currency not recognized'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mshows clarification input when needsClarification is true
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'AI could not determine currency'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'100 pesos'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response from background: {
  success: [33mfalse[39m,
  error: [32m'AI parsing failed'[39m,
  needsClarification: [32m'Please specify pesos type (MXN, COP, etc.)'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'100 pesos'[39m,
  clarification: [32m'MXN'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2msends clarification message and displays result after retry
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m100[39m,
  originalCurrency: [32m'MXN'[39m,
  convertedAmount: [33m30.5[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m0.305[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'50 GBP'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers conversion on Enter key press in main input
[22m[39mReceived response from background: {
  success: [33mtrue[39m,
  originalAmount: [33m50[39m,
  originalCurrency: [32m'GBP'[39m,
  convertedAmount: [33m250[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m5[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending message to background: { action: [32m'parseAndConvertCurrency'[39m, text: [32m'200 something'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response from background: { success: [33mfalse[39m, needsClarification: [32m'Specify currency code'[39m }

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mSending clarification message: {
  action: [32m'clarifyAndConvertCurrency'[39m,
  originalText: [32m'200 something'[39m,
  clarification: [32m'CAD'[39m
}

[90mstdout[2m | src/components/CurrencyConverter/CurrencyConverter.test.tsx[2m > [22m[2mCurrencyConverter Component[2m > [22m[2mtriggers retry on Enter key press in clarification input
[22m[39mReceived response after clarification: {
  success: [33mtrue[39m,
  originalAmount: [33m200[39m,
  originalCurrency: [32m'CAD'[39m,
  convertedAmount: [33m600[39m,
  targetCurrency: [32m'PLN'[39m,
  rate: [33m3[39m
}

 [32mÔťô[39m src/components/CurrencyConverter/CurrencyConverter.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 392[2mms[22m[39m

[2m Test Files [22m [1m[32m5 passed[39m[22m[90m (5)[39m
[2m      Tests [22m [1m[32m42 passed[39m[22m[90m (42)[39m
[2m   Start at [22m 07:20:53
[2m   Duration [22m 3.16s[2m (transform 540ms, setup 1.33s, collect 1.14s, tests 588ms, environment 6.07s, prepare 1.34s)[22m

